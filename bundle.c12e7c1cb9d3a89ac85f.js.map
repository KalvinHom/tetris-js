{"version":3,"sources":["webpack:///./src/piece.js","webpack:///./src/l_piece.js","webpack:///./src/game.js","webpack:///./src/l2_piece.js","webpack:///./src/z_piece.js","webpack:///./src/z2_piece.js","webpack:///./src/t_piece.js","webpack:///./src/line_piece.js","webpack:///./src/o_piece.js","webpack:///./src/script.js","webpack:///./src/board.js","webpack:///./src/canvas.js","webpack:///./src/constants.js"],"names":["constructor","this","rotation_index","rotations","getShape","rotate","direction","limit","length","Piece","super","color","PIECES","LPiece","game","board","width","height","Array","fill","map","clearLines","linesCleared","i","filledLine","j","splice","unshift","isSpotAvailable","piece","x","y","shape","placePiece","canvas","boardPosX","boardPosY","cellSize","levelPosX","levelPosY","scorePosX","scorePosY","previewX","previewY","boarderColor","borderThickness","document","querySelector","window","innerWidth","innerHeight","context","getContext","drawPiecePreview","scoreBorder","beginPath","lineWidth","moveTo","lineTo","closePath","strokeStyle","borderColor","stroke","drawSquare","drawLevel","level","font","fillStyle","fillText","drawScore","score","drawBorders","boardBorder","drawGrid","boardRight","boardBottom","drawBoard","clearRect","fillRect","drawPiece","posX","posY","state","gameSpeed","speedMode","speedAmount","numClears","placeNewPiece","nextPiece","setNextPiece","currentPiece","pieceX","pieceY","gameOver","rotatedPiece","Object","assign","verifyRotation","render","offset","movePieceLeft","movePieceRight","speedOn","speedOff","incrementPiece","addScore","addLevel","console","log","Math","pow","rand","floor","random","startGame","lastRenderTime","Date","now","requestAnimationFrame","tick","bind","fired","addEventListener","event","repeat","key"],"mappings":"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","file":"bundle.c12e7c1cb9d3a89ac85f.js","sourcesContent":["class Piece {\n  constructor() {\n    this.rotation_index = 0;\n    this.rotations = [];\n  }\n\n  getShape() {\n    return this.rotations[this.rotation_index];\n  }\n  rotate(direction) {\n    const limit = this.rotations.length;\n    this.rotation_index = this.rotation_index + direction;\n    if (this.rotation_index >= limit) {\n      this.rotation_index = 0;\n    }\n    if (this.rotation_index < 0) this.rotation_index = limit - 1;\n  }\n}\n\nexport default Piece;\n","import Piece from \"./piece\";\n\nclass LPiece extends Piece {\n  constructor() {\n    super();\n    this.color = \"green\";\n    this.rotations = [\n      [\n        [0, 0, 1],\n        [1, 1, 1],\n        [0, 0, 0],\n      ],\n      [\n        [0, 1, 0],\n        [0, 1, 0],\n        [0, 1, 1],\n      ],\n      [\n        [0, 0, 0],\n        [1, 1, 1],\n        [1, 0, 0],\n      ],\n\n      [\n        [1, 1, 0],\n        [0, 1, 0],\n        [0, 1, 0],\n      ],\n    ];\n  }\n}\n\nexport default LPiece;\n","import Board from \"./board\";\nimport Canvas from \"./canvas\";\nimport LinePiece from \"./line_piece\";\nimport LPiece from \"./l_piece\";\nimport L2Piece from \"./l2_piece\";\nimport OPiece from \"./o_piece\";\nimport ZPiece from \"./z_piece\";\nimport Z2Piece from \"./z2_piece\";\nimport TPiece from \"./t_piece\";\n\nconst PIECES = [LPiece, L2Piece, ZPiece, Z2Piece, TPiece, LinePiece, OPiece];\n\nconst ALIVE = 0;\nconst GAMEOVER = 1;\n\nclass Game {\n  constructor() {\n    this.board = new Board(10, 22);\n    this.canvas = new Canvas(this.board);\n    this.state = ALIVE;\n    this.gameSpeed = 1000;\n    this.speedMode = false;\n    this.speedAmount = 10;\n    this.level = 1;\n    this.score = 0;\n    this.numClears = 0;\n  }\n\n  placeNewPiece() {\n    const piece = this.nextPiece;\n    this.setNextPiece();\n    this.currentPiece = piece;\n    this.pieceX = 3;\n    this.pieceY = 0;\n\n    const available = this.board.isSpotAvailable(\n      this.currentPiece,\n      this.pieceX,\n      this.pieceY\n    );\n    if (!available) this.gameOver();\n  }\n\n  rotate(direction) {\n    let rotatedPiece = Object.assign(this.currentPiece, {});\n    rotatedPiece.rotate(direction);\n    const isValid = this.verifyRotation(rotatedPiece, 0);\n    if (isValid) this.currentPiece = rotatedPiece;\n    this.render();\n  }\n\n  // if the rotated piece doesn't fit its spot, attempt to shift it one right\n  // and then one left.  If no result fits, the piece does not rotate.\n  verifyRotation(piece, offset) {\n    const isValid = this.board.isSpotAvailable(\n      piece,\n      this.pieceX + offset,\n      this.pieceY\n    );\n\n    if (isValid) {\n      this.pieceX += offset;\n      return true;\n    }\n    if (offset == 0) return this.verifyRotation(piece, 1);\n    if (offset == 1) return this.verifyRotation(piece, -1);\n    return false;\n  }\n\n  gameOver() {\n    this.state = GAMEOVER;\n    this.canvas.drawPiece(this.currentPiece);\n  }\n\n  movePieceLeft() {\n    const available = this.board.isSpotAvailable(\n      this.currentPiece,\n      this.pieceX - 1,\n      this.pieceY\n    );\n    if (available) this.pieceX -= 1;\n    this.render();\n  }\n\n  movePieceRight() {\n    const available = this.board.isSpotAvailable(\n      this.currentPiece,\n      this.pieceX + 1,\n      this.pieceY\n    );\n    if (available) this.pieceX += 1;\n    this.render();\n  }\n\n  speedOn() {\n    this.speedMode = true;\n  }\n\n  speedOff() {\n    this.speedMode = false;\n  }\n  incrementPiece() {\n    const available = this.board.isSpotAvailable(\n      this.currentPiece,\n      this.pieceX,\n      this.pieceY + 1\n    );\n    if (available) this.pieceY = this.pieceY + 1;\n    else {\n      this.board.placePiece(this.currentPiece, this.pieceX, this.pieceY);\n      const linesCleared = this.board.clearLines();\n      if (linesCleared > 0) this.numClears++;\n      if (this.numClears == 10) {\n        this.level++;\n        this.numClears = 0;\n      }\n\n      this.addScore(linesCleared);\n      this.addLevel();\n      this.placeNewPiece(this.currentPiece);\n    }\n  }\n\n  addScore(linesCleared) {\n    if (linesCleared > 0) {\n      console.log(linesCleared);\n      console.log(this.level * Math.pow(2, linesCleared - 1) * 100);\n      this.score += this.level * Math.pow(2, linesCleared - 1) * 100;\n    }\n  }\n  addLevel() {\n    if (this.score / 1000 / this.level > this.level) {\n      this.level++;\n      this.gameSpeed / 2;\n    }\n  }\n\n  setNextPiece() {\n    const rand = Math.floor(Math.random() * 7);\n    this.nextPiece = new PIECES[rand]();\n  }\n\n  startGame() {\n    this.lastRenderTime = Date.now();\n    this.setNextPiece();\n    window.requestAnimationFrame(this.tick.bind(this));\n  }\n\n  render() {\n    this.canvas.drawBoard();\n    this.canvas.drawScore(this.score);\n    this.canvas.drawPiecePreview(this.nextPiece);\n    this.canvas.drawLevel(this.level);\n\n    if (this.currentPiece)\n      this.canvas.drawPiece(this.currentPiece, this.pieceX, this.pieceY);\n  }\n  tick() {\n    if (this.state == GAMEOVER) return;\n    const elapsed = Date.now() - this.lastRenderTime;\n    const speed = this.speedMode ? this.speedAmount : this.gameSpeed;\n\n    if (elapsed > speed) {\n      this.canvas.drawBoard();\n      if (!this.currentPiece) this.placeNewPiece();\n      else this.incrementPiece();\n      this.render();\n\n      this.lastRenderTime = Date.now();\n    }\n    window.requestAnimationFrame(this.tick.bind(this));\n  }\n}\n\nexport default Game;\n","import Piece from \"./piece\";\n\nclass L2Piece extends Piece {\n  constructor() {\n    super();\n    this.color = \"red\";\n    this.rotations = [\n      [\n        [0, 0, 0],\n        [1, 1, 1],\n        [0, 0, 1],\n      ],\n      [\n        [0, 1, 0],\n        [0, 1, 0],\n        [1, 1, 0],\n      ],\n      [\n        [1, 0, 0],\n        [1, 1, 1],\n        [0, 0, 0],\n      ],\n\n      [\n        [0, 1, 1],\n        [0, 1, 0],\n        [0, 1, 0],\n      ],\n    ];\n  }\n}\n\nexport default L2Piece;\n","import Piece from \"./piece\";\n\nclass ZPiece extends Piece {\n  constructor() {\n    super();\n    this.color = \"cyan\";\n    this.rotations = [\n      [\n        [0, 0, 0],\n        [1, 1, 0],\n        [0, 1, 1],\n      ],\n      [\n        [0, 0, 1],\n        [0, 1, 1],\n        [0, 1, 0],\n      ],\n    ];\n  }\n}\n\nexport default ZPiece;\n","import Piece from \"./piece\";\n\nclass Z2Piece extends Piece {\n  constructor() {\n    super();\n    this.color = \"orange\";\n    this.rotations = [\n      [\n        [0, 0, 0],\n        [0, 1, 1],\n        [1, 1, 0],\n      ],\n      [\n        [1, 0, 0],\n        [1, 1, 0],\n        [0, 1, 0],\n      ],\n    ];\n  }\n}\n\nexport default Z2Piece;\n","import Piece from \"./piece\";\n\nclass TPiece extends Piece {\n  constructor() {\n    super();\n    this.color = \"pink\";\n    this.rotations = [\n      [\n        [0, 1, 0],\n        [1, 1, 1],\n        [0, 0, 0],\n      ],\n      [\n        [0, 1, 0],\n        [0, 1, 1],\n        [0, 1, 0],\n      ],\n      [\n        [0, 0, 0],\n        [1, 1, 1],\n        [0, 1, 0],\n      ],\n\n      [\n        [0, 1, 0],\n        [1, 1, 0],\n        [0, 1, 0],\n      ],\n    ];\n  }\n}\n\nexport default TPiece;\n","import Piece from \"./piece\";\n\nclass LinePiece extends Piece {\n  constructor() {\n    super();\n    this.color = \"blue\";\n    this.rotations = [\n      [\n        [0, 1, 0, 0],\n        [0, 1, 0, 0],\n        [0, 1, 0, 0],\n        [0, 1, 0, 0],\n      ],\n      [\n        [0, 0, 0, 0],\n        [1, 1, 1, 1],\n        [0, 0, 0, 0],\n        [0, 0, 0, 0],\n      ],\n    ];\n  }\n}\n\nexport default LinePiece;\n","import Piece from \"./piece\";\n\nclass OPiece extends Piece {\n  constructor() {\n    super();\n    this.color = \"yellow\";\n    this.rotations = [\n      [\n        [1, 1],\n        [1, 1],\n      ],\n    ];\n  }\n}\n\nexport default OPiece;\n","import LPiece from \"./l_piece\";\nimport Board from \"./board\";\nimport Canvas from \"./canvas\";\nimport Game from \"./game\";\nimport \"./style.css\";\nimport { CLOCKWISE, COUNTERCLOCKWISE } from \"./constants\";\n\nconst piece = new LPiece();\n\nconst game = new Game();\ngame.startGame();\n\nlet fired = false;\nwindow.addEventListener(\"keydown\", function (event) {\n  if (event.repeat) return;\n  if (fired) return;\n  fired = true;\n  event.key;\n  switch (event.key) {\n    case \"ArrowLeft\":\n    case \"a\":\n      game.movePieceLeft();\n      break;\n    case \"ArrowRight\":\n    case \"d\":\n      game.movePieceRight();\n      break;\n    case \"ArrowDown\":\n    case \"s\":\n      game.speedOn();\n      break;\n    case \"q\":\n      game.rotate(COUNTERCLOCKWISE);\n      break;\n    case \"e\":\n      game.rotate(CLOCKWISE);\n      break;\n    default:\n      fired = false;\n\n      return;\n  }\n  fired = false;\n});\n\nwindow.addEventListener(\"keyup\", function (event) {\n  switch (event.key) {\n    case \"ArrowDown\":\n    case \"s\":\n      game.speedOff();\n      break;\n    default:\n      return;\n  }\n});\n","class Board {\n  constructor(width, height) {\n    this.width = width;\n    this.height = height;\n    this.board = Array(this.height)\n      .fill()\n      .map(() => Array(this.width));\n  }\n\n  clearLines() {\n    let linesCleared = 0;\n    let i = this.height - 1;\n    while (i > 0) {\n      let filledLine = true;\n      for (let j = 0; j < this.width; j++) {\n        if (this.board[i][j] == null) {\n          filledLine = false;\n          break;\n        }\n      }\n\n      if (filledLine) {\n        this.board.splice(i, 1);\n        this.board.unshift(Array(this.width));\n        linesCleared++;\n      } else {\n        i--;\n      }\n    }\n    return linesCleared;\n  }\n\n  isSpotAvailable(piece, x, y) {\n    if (y >= this.height) return false;\n\n    const shape = piece.getShape();\n    for (let i = 0; i < shape.length; ++i) {\n      for (let j = 0; j < shape[i].length; ++j) {\n        if (shape[j][i] != 0) {\n          if (y + j >= this.height) return false;\n          if (x + i < 0 || x + i >= this.width) return false;\n          if (this.board[y + j][x + i] != null) {\n            return false;\n          }\n        }\n      }\n    }\n    return true;\n  }\n\n  placePiece(piece, x, y) {\n    const shape = piece.getShape();\n    for (let i = 0; i < shape.length; ++i) {\n      for (let j = 0; j < shape[i].length; ++j) {\n        if (shape[j][i] != 0) {\n          this.board[y + j][x + i] = piece.color;\n        }\n      }\n    }\n  }\n}\n\nexport default Board;\n","import Board from \"./board\";\n\n// this class focuses on how to draw elements\nclass Canvas {\n  constructor(board) {\n    this.boardPosX = 28;\n    this.boardPosY = 28;\n    this.cellSize = 28;\n\n    this.levelPosX = 450;\n    this.levelPosY = 375;\n    this.scorePosX = 450;\n    this.scorePosY = 428;\n\n    this.previewX = 400;\n    this.previewY = 28;\n\n    this.board = board;\n    this.boarderColor = \"#fff\";\n    this.borderThickness = 0.5;\n\n    this.canvas = document.querySelector(\"canvas.tetris\");\n\n    this.canvas.width = window.innerWidth;\n    this.canvas.height = window.innerHeight;\n    this.context = this.canvas.getContext(\"2d\");\n  }\n\n  drawPiecePreview(piece) {\n    const scoreBorder = [\n      this.previewX - this.borderThickness,\n      this.previewY - this.borderThickness,\n      this.borderThickness + this.previewX + 200,\n      this.borderThickness + this.previewY + 200,\n    ];\n\n    this.context.beginPath();\n    this.context.lineWidth = 1;\n    this.context.moveTo(scoreBorder[0], scoreBorder[1]);\n    this.context.lineTo(scoreBorder[2], scoreBorder[1]);\n    this.context.lineTo(scoreBorder[2], scoreBorder[3]);\n    this.context.lineTo(scoreBorder[0], scoreBorder[3]);\n    this.context.closePath();\n    this.context.strokeStyle = this.borderColor;\n    this.context.stroke();\n    const shape = piece.getShape();\n    for (let i = 0; i < shape.length; ++i) {\n      for (let j = 0; j < shape[i].length; ++j) {\n        if (shape[i][j] != 0) {\n          this.drawSquare(\n            this.previewX + 50 + j * this.cellSize,\n            this.previewY + 50 + i * this.cellSize,\n            piece.color\n          );\n        }\n      }\n    }\n  }\n\n  drawLevel(level) {\n    this.context.stroke();\n    this.context.font = \"40px serif\";\n    this.context.fillStyle = \"#000000\";\n    this.context.fillText(`Level: ${level}`, this.levelPosX, this.levelPosY);\n  }\n\n  drawScore(score) {\n    this.context.stroke();\n    this.context.font = \"40px serif\";\n    this.context.fillStyle = \"#000000\";\n    this.context.fillText(`Score: ${score}`, this.scorePosX, this.scorePosY);\n  }\n\n  drawBorders() {\n    const boardBorder = [\n      this.boardPosX - this.borderThickness,\n      this.boardPosY - this.borderThickness,\n      this.borderThickness + this.boardPosX + this.board.width * this.cellSize,\n      this.borderThickness + this.boardPosY + this.board.height * this.cellSize,\n    ];\n    this.context.beginPath();\n    this.context.lineWidth = 1;\n    this.context.moveTo(boardBorder[0], boardBorder[1]);\n    this.context.lineTo(boardBorder[2], boardBorder[1]);\n    this.context.lineTo(boardBorder[2], boardBorder[3]);\n    this.context.lineTo(boardBorder[0], boardBorder[3]);\n    this.context.closePath();\n    this.context.strokeStyle = this.borderColor;\n\n    this.context.stroke();\n  }\n\n  drawGrid() {\n    // horizontal lines\n    this.context.strokeStyle = this.borderColor;\n    this.context.lineWidth = 0.5;\n\n    const boardRight = this.boardPosX + this.cellSize * this.board.width;\n    for (let i = 1; i < this.board.height; i++) {\n      const height = this.boardPosY + i * this.cellSize;\n      this.context.beginPath();\n      this.context.moveTo(this.boardPosX, height);\n      this.context.lineTo(boardRight, height);\n      this.context.closePath();\n      this.context.stroke();\n    }\n\n    // vertical lines\n    this.context.strokeStyle = this.borderColor;\n    const boardBottom = this.boardPosY + this.cellSize * this.board.height;\n    for (let i = 1; i < this.board.width; i++) {\n      const height = this.boardPosX + i * this.cellSize;\n      this.context.beginPath();\n      this.context.moveTo(height, this.boardPosY);\n      this.context.lineTo(height, boardBottom);\n      this.context.closePath();\n      this.context.stroke();\n    }\n  }\n  drawBoard() {\n    this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);\n    this.drawBorders();\n    this.drawGrid();\n\n    for (let i = 0; i < this.board.height; i++) {\n      for (let j = 0; j < this.board.width; j++) {\n        if (this.board.board[i][j] != null) {\n          this.drawSquare(\n            this.boardPosX + j * this.cellSize,\n            this.boardPosY + i * this.cellSize,\n            this.board.board[i][j]\n          );\n        }\n      }\n    }\n  }\n\n  drawSquare(x, y, color) {\n    this.context.beginPath();\n\n    this.context.fillStyle = color;\n\n    this.context.fillRect(\n      x + 0.5,\n      y + 0.5,\n      this.cellSize - 1,\n      this.cellSize - 1\n    );\n  }\n\n  drawPiece(piece, posX, posY) {\n    const shape = piece.getShape();\n    for (let i = 0; i < shape.length; ++i) {\n      for (let j = 0; j < shape[i].length; ++j) {\n        if (shape[i][j] != 0) {\n          this.drawSquare(\n            this.boardPosX + (posX + j) * this.cellSize,\n            this.boardPosY + (posY + i) * this.cellSize,\n            piece.color\n          );\n        }\n      }\n    }\n  }\n}\n\nexport default Canvas;\n","export const COUNTERCLOCKWISE = -1;\nexport const CLOCKWISE = 1;\n"],"sourceRoot":""}