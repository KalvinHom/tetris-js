(()=>{"use strict";const t=class{constructor(){this.rotation_index=0,this.rotations=[]}getShape(){return this.rotations[this.rotation_index]}rotate(t){const e=this.rotations.length;this.rotation_index=this.rotation_index+t,this.rotation_index>=e&&(this.rotation_index=0),this.rotation_index<0&&(this.rotation_index=e-1)}},e=class extends t{constructor(){super(),this.color="green",this.rotations=[[[0,0,1],[1,1,1],[0,0,0]],[[0,1,0],[0,1,0],[0,1,1]],[[0,0,0],[1,1,1],[1,0,0]],[[1,1,0],[0,1,0],[0,1,0]]]}},i=[e,class extends t{constructor(){super(),this.color="red",this.rotations=[[[0,0,0],[1,1,1],[0,0,1]],[[0,1,0],[0,1,0],[1,1,0]],[[1,0,0],[1,1,1],[0,0,0]],[[0,1,1],[0,1,0],[0,1,0]]]}},class extends t{constructor(){super(),this.color="cyan",this.rotations=[[[0,0,0],[1,1,0],[0,1,1]],[[0,0,1],[0,1,1],[0,1,0]]]}},class extends t{constructor(){super(),this.color="orange",this.rotations=[[[0,0,0],[0,1,1],[1,1,0]],[[1,0,0],[1,1,0],[0,1,0]]]}},class extends t{constructor(){super(),this.color="pink",this.rotations=[[[0,1,0],[1,1,1],[0,0,0]],[[0,1,0],[0,1,1],[0,1,0]],[[0,0,0],[1,1,1],[0,1,0]],[[0,1,0],[1,1,0],[0,1,0]]]}},class extends t{constructor(){super(),this.color="blue",this.rotations=[[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],[[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0]]]}},class extends t{constructor(){super(),this.color="yellow",this.rotations=[[[1,1],[1,1]]]}}],s={x:500,y:500,width:250,height:100},h=(new e,new class{constructor(){this.setDefaults(),this.handleRestart=this.handleRestart.bind(this)}setDefaults(){this.board=new class{constructor(t,e){this.width=t,this.height=e,this.board=Array(this.height).fill().map((()=>Array(this.width)))}clearLines(){let t=0,e=this.height-1;for(;e>0;){let i=!0;for(let t=0;t<this.width;t++)if(null==this.board[e][t]){i=!1;break}i?(this.board.splice(e,1),this.board.unshift(Array(this.width)),t++):e--}return t}isSpotAvailable(t,e,i){if(i>=this.height)return!1;const s=t.getShape();for(let t=0;t<s.length;++t)for(let h=0;h<s[t].length;++h)if(0!=s[h][t]){if(i+h>=this.height)return!1;if(e+t<0||e+t>=this.width)return!1;if(null!=this.board[i+h][e+t])return!1}return!0}placePiece(t,e,i){const s=t.getShape();for(let h=0;h<s.length;++h)for(let o=0;o<s[h].length;++o)0!=s[o][h]&&(this.board[i+o][e+h]=t.color)}}(10,25),this.canvas=new class{constructor(t){this.boardPosX=28,this.boardPosY=28,this.cellSize=28,this.levelPosX=450,this.levelPosY=375,this.scorePosX=450,this.scorePosY=428,this.previewX=400,this.previewY=120,this.board=t,this.boarderColor="#fff",this.borderThickness=.5,this.canvas=document.querySelector("canvas.tetris"),this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.context=this.canvas.getContext("2d")}drawBorders(){const t=[this.boardPosX-this.borderThickness,this.boardPosY+3*this.cellSize-this.borderThickness,this.borderThickness+this.boardPosX+this.board.width*this.cellSize,this.borderThickness+this.boardPosY+this.board.height*this.cellSize];this.context.beginPath(),this.context.lineWidth=1,this.context.moveTo(t[0],t[1]),this.context.lineTo(t[2],t[1]),this.context.lineTo(t[2],t[3]),this.context.lineTo(t[0],t[3]),this.context.closePath(),this.context.strokeStyle=this.borderColor,this.context.stroke()}drawGrid(){this.context.strokeStyle=this.borderColor,this.context.lineWidth=.5;const t=this.boardPosX+this.cellSize*this.board.width;for(let e=3;e<this.board.height;e++){const i=this.boardPosY+e*this.cellSize;this.context.beginPath(),this.context.moveTo(this.boardPosX,i),this.context.lineTo(t,i),this.context.closePath(),this.context.stroke()}this.context.strokeStyle=this.borderColor;const e=this.boardPosY+this.cellSize*this.board.height;for(let t=1;t<this.board.width;t++){const i=this.boardPosX+t*this.cellSize;this.context.beginPath(),this.context.moveTo(i,this.boardPosY+3*this.cellSize),this.context.lineTo(i,e),this.context.closePath(),this.context.stroke()}}drawBoard(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.drawBorders(),this.drawGrid();for(let t=3;t<this.board.height;t++)for(let e=0;e<this.board.width;e++)null!=this.board.board[t][e]&&this.drawSquare(this.boardPosX+e*this.cellSize,this.boardPosY+t*this.cellSize,this.board.board[t][e])}drawLevel(t){this.context.font="40px serif",this.context.fillStyle="#000000",this.context.fillText(`Level: ${t}`,this.levelPosX,this.levelPosY)}drawScore(t){this.context.font="40px serif",this.context.fillStyle="#000000",this.context.fillText(`Score: ${t}`,this.scorePosX,this.scorePosY)}drawPiecePreview(t){const e=[this.previewX-this.borderThickness,this.previewY-this.borderThickness,this.borderThickness+this.previewX+200,this.borderThickness+this.previewY+150];this.context.beginPath(),this.context.lineWidth=1,this.context.moveTo(e[0],e[1]),this.context.lineTo(e[2],e[1]),this.context.lineTo(e[2],e[3]),this.context.lineTo(e[0],e[3]),this.context.closePath(),this.context.strokeStyle="black",this.context.stroke();const i=t.getShape();for(let e=0;e<i.length;++e)for(let s=0;s<i[e].length;++s)0!=i[e][s]&&this.drawSquare(this.previewX+30+s*this.cellSize,this.previewY+35+e*this.cellSize,t.color)}drawPiece(t,e,i){const s=t.getShape();for(let h=0;h<s.length;++h)for(let o=0;o<s[h].length;++o)0!=s[h][o]&&i+h>=3&&this.drawSquare(this.boardPosX+(e+o)*this.cellSize,this.boardPosY+(i+h)*this.cellSize,t.color)}drawSquare(t,e,i){this.context.beginPath(),this.context.fillStyle=i,this.context.fillRect(t+.5,e+.5,this.cellSize-1,this.cellSize-1)}drawRestart(){this.context.beginPath(),this.context.rect(500,500,250,100),this.context.fillStyle="#000000",this.context.fillStyle="rgba(225,225,225,0.5)",this.context.fill(),this.context.lineWidth=2,this.context.strokeStyle="#000000",this.context.stroke(),this.context.closePath(),this.context.font="40pt Serif",this.context.fillStyle="#000000",this.context.fillText("Restart",550,570)}drawControls(){this.context.font="20px serif",this.context.fillStyle="#000000",this.context.fillText("Controls:",550,700),this.context.fillText("Q/E - rotate",550,720),this.context.fillText("W/D or left/right arrows - left/right",550,740),this.context.fillText("S or down arrow - speed down",550,760)}}(this.board),this.state=0,this.gameSpeed=1e3,this.speedMode=!1,this.speedAmount=10,this.level=1,this.score=0,this.numClears=0,this.timesCleared=0}startGame(){this.lastRenderTime=Date.now(),this.setNextPiece(),window.requestAnimationFrame(this.tick.bind(this))}restartGame(){this.setDefaults(),this.canvas.canvas.removeEventListener("click",this.handleRestart,!1),this.startGame()}gameOver(){this.state=1,this.canvas.drawPiece(this.currentPiece),this.canvas.drawRestart(),this.render()}setNextPiece(){const t=Math.floor(7*Math.random());this.nextPiece=new i[t]}movePiece(t){this.board.isSpotAvailable(this.currentPiece,this.pieceX+t,this.pieceY)&&(this.pieceX+=t),this.render()}incrementPiece(){if(this.board.isSpotAvailable(this.currentPiece,this.pieceX,this.pieceY+1))this.pieceY=this.pieceY+1;else{this.board.placePiece(this.currentPiece,this.pieceX,this.pieceY);const t=this.board.clearLines();this.addScore(t),this.placeNewPiece(this.currentPiece)}}placeNewPiece(){const t=this.nextPiece;this.setNextPiece(),this.currentPiece=t,this.pieceX=3,this.pieceY=0,this.board.isSpotAvailable(this.currentPiece,this.pieceX,this.pieceY)||this.gameOver()}rotate(t){let e=Object.assign(Object.create(Object.getPrototypeOf(this.currentPiece)),this.currentPiece);e.rotate(t),this.verifyRotation(e,0)&&(this.currentPiece=e),this.render()}verifyRotation(t,e){return this.board.isSpotAvailable(t,this.pieceX+e,this.pieceY)?(this.pieceX+=e,!0):0==e?this.verifyRotation(t,1):1==e&&this.verifyRotation(t,-1)}addScore(t){t>0&&(this.score+=this.level*Math.pow(2,t-1)*100,this.timesCleared++,this.addLevel())}addLevel(){0!=this.timesCleared&&this.timesCleared%10==0&&(this.level++,this.gameSpeed/=2)}speedOn(){this.speedMode=!0}speedOff(){this.speedMode=!1}showRestart(){this.canvas.canvas.addEventListener("click",this.handleRestart,!1),this.canvas.drawRestart()}tick(){1!=this.state?(Date.now()-this.lastRenderTime>(this.speedMode?this.speedAmount:this.gameSpeed)&&(this.canvas.drawBoard(),this.currentPiece?this.incrementPiece():this.placeNewPiece(),this.render(),this.lastRenderTime=Date.now()),window.requestAnimationFrame(this.tick.bind(this))):this.showRestart()}render(){this.canvas.drawBoard(),this.canvas.drawScore(this.score),this.canvas.drawPiecePreview(this.nextPiece),this.canvas.drawLevel(this.level),this.canvas.drawControls(),1!=this.state?this.currentPiece&&this.canvas.drawPiece(this.currentPiece,this.pieceX,this.pieceY):this.showRestart()}getMousePos(t,e){var i=t.getBoundingClientRect();return{x:e.clientX-i.left,y:e.clientY-i.top}}isInside(t,e){return t.x>e.x&&t.x<e.x+e.width&&t.y<e.y+e.height&&t.y>e.y}handleRestart(t){var e=this.getMousePos(this.canvas.canvas,t);this.isInside(e,s)&&this.restartGame()}});h.startGame();let o=!1;window.addEventListener("keydown",(function(t){if(!o){switch(o=!0,t.key,t.key){case"ArrowLeft":case"a":h.movePiece(-1);break;case"ArrowRight":case"d":h.movePiece(1);break;case"ArrowDown":case"s":h.speedOn();break;case"q":h.rotate(-1);break;case"e":h.rotate(1);break;default:return void(o=!1)}o=!1}})),window.addEventListener("keyup",(function(t){switch(t.key){case"ArrowDown":case"s":h.speedOff();break;default:return}}))})();
//# sourceMappingURL=bundle.45960b7a4769e39fca40.js.map