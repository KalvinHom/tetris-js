{"version":3,"sources":["webpack:///./src/piece.js","webpack:///./src/l_piece.js","webpack:///./src/z_piece.js","webpack:///./src/game.js","webpack:///./src/l2_piece.js","webpack:///./src/t_piece.js","webpack:///./src/line_piece.js","webpack:///./src/o_piece.js","webpack:///./src/script.js","webpack:///./src/board.js","webpack:///./src/canvas.js","webpack:///./src/constants.js"],"names":["constructor","this","rotation_index","rotations","getShape","rotate","direction","limit","length","Piece","super","color","PIECES","LPiece","ZPiece","Z2Piece","game","board","width","height","Array","fill","map","clearLines","linesCleared","i","filledLine","j","splice","unshift","isSpotAvailable","piece","x","y","shape","placePiece","canvas","boardPosX","boardPosY","cellSize","levelPosX","levelPosY","scorePosX","scorePosY","previewX","previewY","boarderColor","borderThickness","document","querySelector","window","innerWidth","innerHeight","context","getContext","drawPiecePreview","scoreBorder","beginPath","lineWidth","moveTo","lineTo","closePath","strokeStyle","borderColor","stroke","drawSquare","drawLevel","level","font","fillStyle","fillText","drawScore","score","drawBorders","boardBorder","drawGrid","boardRight","boardBottom","drawBoard","clearRect","fillRect","drawPiece","posX","posY","state","gameSpeed","speedMode","speedAmount","numClears","placeNewPiece","nextPiece","setNextPiece","currentPiece","pieceX","pieceY","gameOver","rotatedPiece","Object","assign","verifyRotation","render","offset","movePieceLeft","movePieceRight","speedOn","speedOff","incrementPiece","addScore","addLevel","console","log","Math","pow","rand","floor","random","startGame","lastRenderTime","Date","now","requestAnimationFrame","tick","bind","addEventListener","event","repeat","key"],"mappings":"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","file":"bundle.9ddd0cf6f90200b28164.js","sourcesContent":["class Piece {\n  constructor() {\n    this.rotation_index = 0;\n    this.rotations = [];\n  }\n\n  getShape() {\n    return this.rotations[this.rotation_index];\n  }\n  rotate(direction) {\n    const limit = this.rotations.length;\n    this.rotation_index = this.rotation_index + direction;\n    if (this.rotation_index >= limit) {\n      this.rotation_index = 0;\n    }\n    if (this.rotation_index < 0) this.rotation_index = limit - 1;\n  }\n}\n\nexport default Piece;\n","import Piece from \"./piece\";\n\nclass LPiece extends Piece {\n  constructor() {\n    super();\n    this.color = \"green\";\n    this.rotations = [\n      [\n        [0, 0, 1],\n        [1, 1, 1],\n        [0, 0, 0],\n      ],\n      [\n        [0, 1, 0],\n        [0, 1, 0],\n        [0, 1, 1],\n      ],\n      [\n        [0, 0, 0],\n        [1, 1, 1],\n        [1, 0, 0],\n      ],\n\n      [\n        [1, 1, 0],\n        [0, 1, 0],\n        [0, 1, 0],\n      ],\n    ];\n  }\n}\n\nexport default LPiece;\n","import Piece from \"./piece\";\n\nclass ZPiece extends Piece {\n  constructor() {\n    super();\n    this.color = \"cyan\";\n    this.rotations = [\n      [\n        [0, 0, 0],\n        [1, 1, 0],\n        [0, 1, 1],\n      ],\n      [\n        [0, 0, 1],\n        [0, 1, 1],\n        [0, 1, 0],\n      ],\n    ];\n  }\n}\n\nexport default ZPiece;\n","import Board from \"./board\";\nimport Canvas from \"./canvas\";\nimport LinePiece from \"./line_piece\";\nimport LPiece from \"./l_piece\";\nimport L2Piece from \"./l2_piece\";\nimport OPiece from \"./o_piece\";\nimport ZPiece from \"./z_piece\";\nimport Z2Piece from \"./z_piece\";\nimport TPiece from \"./t_piece\";\n\nconst PIECES = [LPiece, L2Piece, ZPiece, Z2Piece, TPiece, LinePiece, OPiece];\n\nconst ALIVE = 0;\nconst GAMEOVER = 1;\n\nclass Game {\n  constructor() {\n    this.board = new Board(10, 22);\n    this.canvas = new Canvas(this.board);\n    this.state = ALIVE;\n    this.gameSpeed = 1000;\n    this.speedMode = false;\n    this.speedAmount = 10;\n    this.level = 1;\n    this.score = 0;\n    this.numClears = 0;\n  }\n\n  placeNewPiece() {\n    const piece = this.nextPiece;\n    this.setNextPiece();\n    this.currentPiece = piece;\n    this.pieceX = 3;\n    this.pieceY = 0;\n\n    const available = this.board.isSpotAvailable(\n      this.currentPiece,\n      this.pieceX,\n      this.pieceY\n    );\n    if (!available) this.gameOver();\n  }\n\n  rotate(direction) {\n    let rotatedPiece = Object.assign(this.currentPiece, {});\n    rotatedPiece.rotate(direction);\n    const isValid = this.verifyRotation(rotatedPiece, 0);\n    if (isValid) this.currentPiece = rotatedPiece;\n    this.render();\n  }\n\n  // if the rotated piece doesn't fit its spot, attempt to shift it one right\n  // and then one left.  If no result fits, the piece does not rotate.\n  verifyRotation(piece, offset) {\n    const isValid = this.board.isSpotAvailable(\n      piece,\n      this.pieceX + offset,\n      this.pieceY\n    );\n\n    if (isValid) {\n      this.pieceX += offset;\n      return true;\n    }\n    if (offset == 0) return this.verifyRotation(piece, 1);\n    if (offset == 1) return this.verifyRotation(piece, -1);\n    return false;\n  }\n\n  gameOver() {\n    this.state = GAMEOVER;\n    this.canvas.drawPiece(this.currentPiece);\n  }\n\n  movePieceLeft() {\n    const available = this.board.isSpotAvailable(\n      this.currentPiece,\n      this.pieceX - 1,\n      this.pieceY\n    );\n    if (available) this.pieceX -= 1;\n    this.render();\n  }\n\n  movePieceRight() {\n    const available = this.board.isSpotAvailable(\n      this.currentPiece,\n      this.pieceX + 1,\n      this.pieceY\n    );\n    if (available) this.pieceX += 1;\n    this.render();\n  }\n\n  speedOn() {\n    this.speedMode = true;\n  }\n\n  speedOff() {\n    this.speedMode = false;\n  }\n  incrementPiece() {\n    const available = this.board.isSpotAvailable(\n      this.currentPiece,\n      this.pieceX,\n      this.pieceY + 1\n    );\n    if (available) this.pieceY = this.pieceY + 1;\n    else {\n      this.board.placePiece(this.currentPiece, this.pieceX, this.pieceY);\n      const linesCleared = this.board.clearLines();\n      if (linesCleared > 0) this.numClears++;\n      if (this.numClears == 10) {\n        this.level++;\n        this.numClears = 0;\n      }\n\n      this.addScore(linesCleared);\n      this.addLevel();\n      this.placeNewPiece(this.currentPiece);\n    }\n  }\n\n  addScore(linesCleared) {\n    if (linesCleared > 0) {\n      console.log(linesCleared);\n      console.log(this.level * Math.pow(2, linesCleared - 1) * 100);\n      this.score += this.level * Math.pow(2, linesCleared - 1) * 100;\n    }\n  }\n  addLevel() {\n    if (this.score / 1000 / this.level > this.level) this.level++;\n  }\n\n  setNextPiece() {\n    const rand = Math.floor(Math.random() * 7);\n    this.nextPiece = new PIECES[rand]();\n  }\n\n  startGame() {\n    this.lastRenderTime = Date.now();\n    this.setNextPiece();\n    window.requestAnimationFrame(this.tick.bind(this));\n  }\n\n  render() {\n    this.canvas.drawBoard();\n    this.canvas.drawScore(this.score);\n    this.canvas.drawPiecePreview(this.nextPiece);\n    this.canvas.drawLevel(this.level);\n\n    if (this.currentPiece)\n      this.canvas.drawPiece(this.currentPiece, this.pieceX, this.pieceY);\n  }\n  tick() {\n    if (this.state == GAMEOVER) return;\n    const elapsed = Date.now() - this.lastRenderTime;\n    const speed = this.speedMode ? this.speedAmount : this.gameSpeed;\n\n    if (elapsed > speed) {\n      this.canvas.drawBoard();\n      if (!this.currentPiece) this.placeNewPiece();\n      else this.incrementPiece();\n      this.render();\n\n      this.lastRenderTime = Date.now();\n    }\n    window.requestAnimationFrame(this.tick.bind(this));\n  }\n}\n\nexport default Game;\n","import Piece from \"./piece\";\n\nclass L2Piece extends Piece {\n  constructor() {\n    super();\n    this.color = \"red\";\n    this.rotations = [\n      [\n        [0, 0, 0],\n        [1, 1, 1],\n        [0, 0, 1],\n      ],\n      [\n        [0, 1, 0],\n        [0, 1, 0],\n        [1, 1, 0],\n      ],\n      [\n        [1, 0, 0],\n        [1, 1, 1],\n        [0, 0, 0],\n      ],\n\n      [\n        [0, 1, 1],\n        [0, 1, 0],\n        [0, 1, 0],\n      ],\n    ];\n  }\n}\n\nexport default L2Piece;\n","import Piece from \"./piece\";\n\nclass TPiece extends Piece {\n  constructor() {\n    super();\n    this.color = \"pink\";\n    this.rotations = [\n      [\n        [0, 1, 0],\n        [1, 1, 1],\n        [0, 0, 0],\n      ],\n      [\n        [0, 1, 0],\n        [0, 1, 1],\n        [0, 1, 0],\n      ],\n      [\n        [0, 0, 0],\n        [1, 1, 1],\n        [0, 1, 0],\n      ],\n\n      [\n        [0, 1, 0],\n        [1, 1, 0],\n        [0, 1, 0],\n      ],\n    ];\n  }\n}\n\nexport default TPiece;\n","import Piece from \"./piece\";\n\nclass LinePiece extends Piece {\n  constructor() {\n    super();\n    this.color = \"blue\";\n    this.rotations = [\n      [\n        [0, 1, 0, 0],\n        [0, 1, 0, 0],\n        [0, 1, 0, 0],\n        [0, 1, 0, 0],\n      ],\n      [\n        [0, 0, 0, 0],\n        [1, 1, 1, 1],\n        [0, 0, 0, 0],\n        [0, 0, 0, 0],\n      ],\n    ];\n  }\n}\n\nexport default LinePiece;\n","import Piece from \"./piece\";\n\nclass OPiece extends Piece {\n  constructor() {\n    super();\n    this.color = \"yellow\";\n    this.rotations = [\n      [\n        [1, 1],\n        [1, 1],\n      ],\n    ];\n  }\n}\n\nexport default OPiece;\n","import LPiece from \"./l_piece\";\nimport Board from \"./board\";\nimport Canvas from \"./canvas\";\nimport Game from \"./game\";\nimport \"./style.css\";\nimport { CLOCKWISE, COUNTERCLOCKWISE } from \"./constants\";\n\nconst piece = new LPiece();\n\nconst game = new Game();\ngame.startGame();\n\nlet timeoutId = 0;\nwindow.addEventListener(\"keydown\", function (event) {\n  if (event.repeat) return;\n  event.key;\n  switch (event.key) {\n    case \"ArrowLeft\":\n    case \"a\":\n      game.movePieceLeft();\n      break;\n    case \"ArrowRight\":\n    case \"d\":\n      game.movePieceRight();\n      break;\n    case \"ArrowDown\":\n    case \"s\":\n      game.speedOn();\n      break;\n    case \"q\":\n      game.rotate(COUNTERCLOCKWISE);\n      break;\n    case \"e\":\n      game.rotate(CLOCKWISE);\n      break;\n    default:\n      return;\n  }\n});\n\nwindow.addEventListener(\"keyup\", function (event) {\n  switch (event.key) {\n    case \"ArrowDown\":\n    case \"s\":\n      game.speedOff();\n      break;\n    default:\n      return;\n  }\n});\n","class Board {\n  constructor(width, height) {\n    this.width = width;\n    this.height = height;\n    this.board = Array(this.height)\n      .fill()\n      .map(() => Array(this.width));\n  }\n\n  clearLines() {\n    let linesCleared = 0;\n    let i = this.height - 1;\n    while (i > 0) {\n      let filledLine = true;\n      for (let j = 0; j < this.width; j++) {\n        if (this.board[i][j] == null) {\n          filledLine = false;\n          break;\n        }\n      }\n\n      if (filledLine) {\n        this.board.splice(i, 1);\n        this.board.unshift(Array(this.width));\n        linesCleared++;\n      } else {\n        i--;\n      }\n    }\n    return linesCleared;\n  }\n\n  isSpotAvailable(piece, x, y) {\n    if (y >= this.height) return false;\n\n    const shape = piece.getShape();\n    for (let i = 0; i < shape.length; ++i) {\n      for (let j = 0; j < shape[i].length; ++j) {\n        if (shape[j][i] != 0) {\n          if (y + j >= this.height) return false;\n          if (x + i < 0 || x + i >= this.width) return false;\n          if (this.board[y + j][x + i] != null) {\n            return false;\n          }\n        }\n      }\n    }\n    return true;\n  }\n\n  placePiece(piece, x, y) {\n    const shape = piece.getShape();\n    for (let i = 0; i < shape.length; ++i) {\n      for (let j = 0; j < shape[i].length; ++j) {\n        if (shape[j][i] != 0) {\n          this.board[y + j][x + i] = piece.color;\n        }\n      }\n    }\n  }\n}\n\nexport default Board;\n","import Board from \"./board\";\n\n// this class focuses on how to draw elements\nclass Canvas {\n  constructor(board) {\n    this.boardPosX = 28;\n    this.boardPosY = 28;\n    this.cellSize = 28;\n\n    this.levelPosX = 450;\n    this.levelPosY = 375;\n    this.scorePosX = 450;\n    this.scorePosY = 428;\n\n    this.previewX = 400;\n    this.previewY = 28;\n\n    this.board = board;\n    this.boarderColor = \"#fff\";\n    this.borderThickness = 0.5;\n\n    this.canvas = document.querySelector(\"canvas.tetris\");\n\n    this.canvas.width = window.innerWidth;\n    this.canvas.height = window.innerHeight;\n    this.context = this.canvas.getContext(\"2d\");\n  }\n\n  drawPiecePreview(piece) {\n    const scoreBorder = [\n      this.previewX - this.borderThickness,\n      this.previewY - this.borderThickness,\n      this.borderThickness + this.previewX + 200,\n      this.borderThickness + this.previewY + 200,\n    ];\n\n    this.context.beginPath();\n    this.context.lineWidth = 1;\n    this.context.moveTo(scoreBorder[0], scoreBorder[1]);\n    this.context.lineTo(scoreBorder[2], scoreBorder[1]);\n    this.context.lineTo(scoreBorder[2], scoreBorder[3]);\n    this.context.lineTo(scoreBorder[0], scoreBorder[3]);\n    this.context.closePath();\n    this.context.strokeStyle = this.borderColor;\n    this.context.stroke();\n    const shape = piece.getShape();\n    for (let i = 0; i < shape.length; ++i) {\n      for (let j = 0; j < shape[i].length; ++j) {\n        if (shape[i][j] != 0) {\n          this.drawSquare(\n            this.previewX + 50 + j * this.cellSize,\n            this.previewY + 50 + i * this.cellSize,\n            piece.color\n          );\n        }\n      }\n    }\n  }\n\n  drawLevel(level) {\n    this.context.stroke();\n    this.context.font = \"40px serif\";\n    this.context.fillStyle = \"#000000\";\n    this.context.fillText(`Level: ${level}`, this.levelPosX, this.levelPosY);\n  }\n\n  drawScore(score) {\n    this.context.stroke();\n    this.context.font = \"40px serif\";\n    this.context.fillStyle = \"#000000\";\n    this.context.fillText(`Score: ${score}`, this.scorePosX, this.scorePosY);\n  }\n\n  drawBorders() {\n    const boardBorder = [\n      this.boardPosX - this.borderThickness,\n      this.boardPosY - this.borderThickness,\n      this.borderThickness + this.boardPosX + this.board.width * this.cellSize,\n      this.borderThickness + this.boardPosY + this.board.height * this.cellSize,\n    ];\n    this.context.beginPath();\n    this.context.lineWidth = 1;\n    this.context.moveTo(boardBorder[0], boardBorder[1]);\n    this.context.lineTo(boardBorder[2], boardBorder[1]);\n    this.context.lineTo(boardBorder[2], boardBorder[3]);\n    this.context.lineTo(boardBorder[0], boardBorder[3]);\n    this.context.closePath();\n    this.context.strokeStyle = this.borderColor;\n\n    this.context.stroke();\n  }\n\n  drawGrid() {\n    // horizontal lines\n    this.context.strokeStyle = this.borderColor;\n    this.context.lineWidth = 0.5;\n\n    const boardRight = this.boardPosX + this.cellSize * this.board.width;\n    for (let i = 1; i < this.board.height; i++) {\n      const height = this.boardPosY + i * this.cellSize;\n      this.context.beginPath();\n      this.context.moveTo(this.boardPosX, height);\n      this.context.lineTo(boardRight, height);\n      this.context.closePath();\n      this.context.stroke();\n    }\n\n    // vertical lines\n    this.context.strokeStyle = this.borderColor;\n    const boardBottom = this.boardPosY + this.cellSize * this.board.height;\n    for (let i = 1; i < this.board.width; i++) {\n      const height = this.boardPosX + i * this.cellSize;\n      this.context.beginPath();\n      this.context.moveTo(height, this.boardPosY);\n      this.context.lineTo(height, boardBottom);\n      this.context.closePath();\n      this.context.stroke();\n    }\n  }\n  drawBoard() {\n    this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);\n    this.drawBorders();\n    this.drawGrid();\n\n    for (let i = 0; i < this.board.height; i++) {\n      for (let j = 0; j < this.board.width; j++) {\n        if (this.board.board[i][j] != null) {\n          this.drawSquare(\n            this.boardPosX + j * this.cellSize,\n            this.boardPosY + i * this.cellSize,\n            this.board.board[i][j]\n          );\n        }\n      }\n    }\n  }\n\n  drawSquare(x, y, color) {\n    this.context.beginPath();\n\n    this.context.fillStyle = color;\n\n    this.context.fillRect(\n      x + 0.5,\n      y + 0.5,\n      this.cellSize - 1,\n      this.cellSize - 1\n    );\n  }\n\n  drawPiece(piece, posX, posY) {\n    const shape = piece.getShape();\n    for (let i = 0; i < shape.length; ++i) {\n      for (let j = 0; j < shape[i].length; ++j) {\n        if (shape[i][j] != 0) {\n          this.drawSquare(\n            this.boardPosX + (posX + j) * this.cellSize,\n            this.boardPosY + (posY + i) * this.cellSize,\n            piece.color\n          );\n        }\n      }\n    }\n  }\n}\n\nexport default Canvas;\n","export const COUNTERCLOCKWISE = -1;\nexport const CLOCKWISE = 1;\n"],"sourceRoot":""}